{% extends "dev.html" %}

{% block title %}应用凭证 - 开发者控制台{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">应用创建成功</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger">
                        <h6><i class="bi bi-exclamation-triangle-fill"></i> 重要安全提醒</h6>
                        <p class="mb-0">App Secret 只会显示一次，请立即保存！离开此页面后将无法再次查看。</p>
                    </div>
                    
                    <div class="mb-4">
                        <h5>应用信息</h5>
                        <table class="table table-bordered">
                            <tr>
                                <th width="30%">应用名称</th>
                                <td>{{ app.app_name }}</td>
                            </tr>
                            <tr>
                                <th>应用描述</th>
                                <td>{{ app.description or '暂无描述' }}</td>
                            </tr>
                            <tr>
                                <th>创建时间</th>
                                <td>{{ app.created_at }}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="mb-4">
                        <h5>应用凭证</h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">App ID</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="{{ app.app_id }}" readonly id="appId">
                                        <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('appId')">
                                            <i class="bi bi-clipboard"></i> 复制
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-0">
                                    <label class="form-label fw-bold">App Secret</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="{{ app_secret }}" readonly id="appSecret">
                                        <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('appSecret')">
                                            <i class="bi bi-clipboard"></i> 复制
                                        </button>
                                    </div>
                                    <div class="form-text text-danger">请立即保存此密钥，离开页面后无法再次查看！</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle"></i> 下一步操作</h6>
                        <ul class="mb-0">
                            <li>将 App ID 和 App Secret 安全地存储在您的应用中</li>
                            <li>使用这些凭证通过框架认证接口获取白板访问权限</li>
                            <li>查看API文档了解如何集成</li>
                        </ul>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('developer.developer_console') }}" class="btn btn-primary">返回控制台</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    element.setSelectionRange(0, 99999); // For mobile devices
    
    navigator.clipboard.writeText(element.value).then(() => {
        // 显示复制成功提示
        const originalText = event.target.innerHTML;
        event.target.innerHTML = '<i class="bi bi-check"></i> 已复制';
        event.target.classList.remove('btn-outline-secondary');
        event.target.classList.add('btn-success');
        
        setTimeout(() => {
            event.target.innerHTML = originalText;
            event.target.classList.remove('btn-success');
            event.target.classList.add('btn-outline-secondary');
        }, 2000);
    }).catch(err => {
        console.error('复制失败: ', err);
        alert('复制失败，请手动选择复制');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const appSecretInput = document.getElementById('appSecret');
    if (appSecretInput) {
        appSecretInput.select();
    }
});
</script>
{% endblock %}